/*
 Navicat Premium Dump SQL

 Source Server         : ku
 Source Server Type    : MySQL
 Source Server Version : 90001 (9.0.1)
 Source Host           : localhost:3306
 Source Schema         : icms

 Target Server Type    : MySQL
 Target Server Version : 90001 (9.0.1)
 File Encoding         : 65001

 Date: 13/07/2025 21:55:51
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for attendance_log
-- ----------------------------
DROP TABLE IF EXISTS `attendance_log`;
CREATE TABLE `attendance_log`  (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '代理主键',
  `log_id` varchar(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '业务主键 (UUID), 考勤记录的唯一ID',
  `user_id` int NOT NULL COMMENT '签到的用户ID',
  `timestamp` datetime(3) NOT NULL COMMENT '签到发生时间',
  `snapshot_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '签到瞬间的现场快照路径 (URL)',
  `confidence_score` decimal(5, 4) NULL DEFAULT NULL COMMENT '识别置信度得分 (0.0000-1.0000)',
  `liveness_score` decimal(5, 4) NULL DEFAULT NULL COMMENT '活体检测得分',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `log_id`(`log_id` ASC) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE,
  INDEX `idx_timestamp`(`timestamp` DESC) USING BTREE,
  CONSTRAINT `fk_attendance_log_to_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '考勤日志表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of attendance_log
-- ----------------------------

-- ----------------------------
-- Table structure for user
-- ----------------------------
DROP TABLE IF EXISTS `user`;
CREATE TABLE `user`  (
  `user_id` int NOT NULL AUTO_INCREMENT COMMENT '用户唯一ID (自增)',
  `username` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '用户名/学号/工号 (唯一)',
  `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '加密后的密码',
  `role` enum('student','teacher') CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '用户角色',
  `created_at` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
  `face_embedding` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL COMMENT '面部特征向量 （存储为JSON数组字符串）',
  `source_image_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '用于注册的源照片存储路径',
  PRIMARY KEY (`user_id`) USING BTREE,
  UNIQUE INDEX `username`(`username` ASC) USING BTREE,
  INDEX `idx_username`(`username` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 3 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '用户表，包含认证用户的面部特征信息' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of user
-- ----------------------------
INSERT INTO `user` VALUES (2, '曹玥', 'b090a8e2dd67f03005adeff82c6b80e7', 'student', '2025-07-13 17:14:19', '2025-07-13 17:14:19', '1.012878656387329,-0.8118181824684143,0.47146785259246826,0.8682730197906494,1.6020731925964355,-0.46313390135765076,-1.4264781475067139,-0.2747824788093567,0.4542770981788635,-1.2757363319396973,1.6367958784103394,1.308359146118164,0.6307307481765747,0.6086458563804626,0.46785426139831543,-1.2079217433929443,0.12152224779129028,0.48445525765419006,-0.9225268959999084,1.112221121788025,-0.015073137357831001,-0.06291713565587997,1.5510902404785156,-2.260103940963745,-1.4907475709915161,-0.12078002095222473,1.8227277994155884,-0.37488943338394165,0.5295107364654541,-1.082176685333252,0.10603588819503784,0.6033022403717041,-0.6714245080947876,1.0450501441955566,-0.5252035856246948,-0.07728150486946106,0.051018018275499344,-0.7655130624771118,-1.9550155401229858,1.4103293418884277,-0.7422426342964172,0.29532986879348755,0.8490587472915649,-1.1282943487167358,-0.22116968035697937,0.09171634912490845,1.6946861743927002,0.9154307246208191,-2.1249794960021973,-1.1000487804412842,-0.25489312410354614,-0.30103471875190735,0.9702581763267517,1.381409764289856,0.36705753207206726,-0.8561628460884094,-0.27665042877197266,1.3218780755996704,0.5025975704193115,-0.48971027135849,-0.9333876967430115,0.6360768675804138,-0.9289546608924866,0.49997788667678833,1.7578712701797485,1.0981858968734741,-0.4224974513053894,-1.5130888223648071,0.3892315626144409,-1.19356107711792,0.4263150095939636,-0.09505921602249146,0.5942806601524353,-0.18131476640701294,0.2798299193382263,-0.9334831237792969,1.0728787183761597,-1.6084235906600952,-1.9564063549041748,0.03177706152200699,1.0138697624206543,1.617039442062378,1.5364834070205688,-0.608447790145874,0.7955752015113831,0.9930554628372192,-0.30360475182533264,-0.3522695302963257,-0.46934041380882263,0.8805973529815674,1.2632077932357788,1.3697718381881714,1.2072806358337402,-2.3387930393218994,-0.7980636954307556,1.5489203929901123,-0.04988410696387291,2.627575635910034,0.04722602665424347,-1.239001750946045,-0.1474929302930832,0.22049079835414886,0.1389613151550293,0.7101254463195801,-0.3392861783504486,0.16328592598438263,1.7687021493911743,-1.0378808975219727,-1.3802669048309326,0.0734199807047844,0.6842419505119324,0.6077740788459778,-1.1682745218276978,0.4293299615383148,-0.3289906084537506,0.5006793141365051,0.15181249380111694,0.2926262617111206,1.2228333950042725,1.5286074876785278,-1.3133631944656372,0.5018295049667358,0.1170702874660492,-1.6194409132003784,-0.48988133668899536,-1.7737252712249756,0.7737063765525818,-1.80490243434906,-0.5349529385566711,-2.09753155708313,0.05497900769114494,0.8096156716346741,0.18134905397891998,0.9959619641304016,-1.7411198616027832,0.8549157381057739,-1.6297566890716553,-1.4499657154083252,0.062304358929395676,-0.7116482257843018,0.44839543104171753,1.7174663543701172,-1.7012996673583984,2.133971691131592,0.7998091578483582,-0.3495956361293793,-1.1954106092453003,0.6072052717208862,0.9988468289375305,1.194466471672058,1.4670710563659668,0.9300731420516968,-2.2290470600128174,3.140134334564209,0.46326255798339844,0.18626859784126282,-0.9060439467430115,-1.0133663415908813,-0.5402889251708984,-1.6569074392318726,1.628381371498108,0.8450598120689392,-0.04605080932378769,0.43187910318374634,0.6602079272270203,1.0282158851623535,-1.2850041389465332,-0.7753353714942932,-1.3436428308486938,0.14527098834514618,-1.1847227811813354,-0.5286650657653809,-1.0162214040756226,-1.1554954051971436,0.7255271673202515,-0.23725563287734985,-0.7717034220695496,-0.7507088780403137,-1.1915465593338013,0.7390379905700684,0.7980296611785889,-0.14583630859851837,-1.6035460233688354,-0.34143614768981934,-0.10200119763612747,0.8633681535720825,-0.9265275001525879,0.6652570366859436,1.765145182609558,1.446799397468567,-0.17526483535766602,0.98721843957901,-0.11831094324588776,-0.3127315640449524,0.045908764004707336,1.2799625396728516,0.2119925320148468,0.7311298847198486,-0.08884669840335846,-0.3868151009082794,0.731139600276947,-1.7574626207351685,-0.47811803221702576,0.6692634224891663,0.80301433801651,0.9201241731643677,-0.04967164248228073,-0.2020910382270813,0.6827007532119751,1.7490516901016235,0.4545091986656189,0.23283188045024872,0.325589656829834,0.08587893843650818,-1.3550103902816772,-0.548844575881958,-0.47109824419021606,0.928801953792572,-1.1161166429519653,0.7090667486190796,-1.551794409751892,-1.647663950920105,0.7697714567184448,-1.1571022272109985,0.6730285882949829,1.7533022165298462,-0.48260942101478577,0.7570009231567383,-0.2680680751800537,-0.542853593826294,1.5042684078216553,0.7421287894248962,0.48253676295280457,-0.5406858325004578,0.4245035648345947,-1.1883435249328613,-0.6555401682853699,0.1455010175704956,0.6960524320602417,0.40565791726112366,0.840662956237793,0.19992493093013763,0.517251193523407,0.3392825126647949,-1.20992112159729,0.5553653836250305,-1.6410856246948242,-0.6048458814620972,-1.1423718929290771,1.268843650817871,-0.06583119183778763,0.17725935578346252,0.8392054438591003,-0.8317440152168274,0.7528783082962036,0.03285647928714752,-0.7304896116256714,0.24480463564395905,1.2213188409805298,-0.7322680354118347,-1.0294557809829712,-0.2685122787952423,1.0337384939193726,-1.4272156953811646,-0.9287734627723694,0.07531429827213287,0.22458207607269287,0.3688320815563202,-0.26607728004455566,-1.5265249013900757,0.6508417129516602,1.9384227991104126,1.3362951278686523,-1.3387585878372192,0.5881428122520447,0.04392307624220848,0.24320930242538452,0.6108129024505615,1.0930284261703491,1.644440770149231,0.12489481270313263,0.8353771567344666,-1.0176873207092285,-0.5937471985816956,-0.8577892780303955,-1.031272530555725,0.8411644697189331,0.4676964282989502,0.8459025621414185,-0.017349202185869217,0.2672670781612396,-0.33848682045936584,-0.050892069935798645,0.368947833776474,0.27892252802848816,-0.8507891893386841,-0.02197154238820076,0.15230236947536469,0.16885779798030853,-0.6755672693252563,0.7079066634178162,0.7981995940208435,-1.0515974760055542,0.4380134046077728,1.3618881702423096,-0.8820196390151978,-0.3197519779205322,0.9896906018257141,-1.0143041610717773,0.972752034664154,-0.7942703366279602,1.4944709539413452,0.24237264692783356,0.8097174763679504,0.9707862138748169,2.3436107635498047,0.38942569494247437,0.43599823117256165,1.680006504058838,1.9993410110473633,1.782899260520935,-0.6119484305381775,1.156833291053772,0.9627279043197632,0.2584577202796936,-1.3524161577224731,0.9885179400444031,1.8970085382461548,0.42529797554016113,0.26937630772590637,0.7099382877349854,0.5535431504249573,1.3876255750656128,-0.1047620177268982,-0.296812504529953,0.4618801772594452,-0.6146894693374634,-0.8762052655220032,0.5253416895866394,-0.3381914496421814,0.7616146802902222,0.06233176589012146,-2.176614761352539,-0.4473872482776642,1.7331492900848389,1.0226482152938843,-0.5944820642471313,0.9702663421630859,1.5383893251419067,-0.7048262357711792,0.27787843346595764,-1.9891046285629272,1.3156306743621826,0.17430487275123596,-0.4221189022064209,0.15484359860420227,-0.16140851378440857,-0.058994993567466736,-0.11308357864618301,3.17879056930542,0.32538649439811707,-1.2232744693756104,-1.0015754699707031,0.24877050518989563,0.8822753429412842,-0.6731855869293213,-0.4870283603668213,-1.1753125190734863,1.0305888652801514,-0.0733540952205658,-0.8963403105735779,-0.7538625001907349,-1.5656569004058838,0.35428547859191895,-0.5879298448562622,2.6383609771728516,0.6037788391113281,0.3020186126232147,-0.18805143237113953,0.5962958335876465,-1.9191149473190308,-1.815679907798767,-0.6701889038085938,-1.6324321031570435,-0.40791216492652893,0.17076238989830017,-0.3844161033630371,0.31711262464523315,1.2285799980163574,-0.6743117570877075,-1.5043816566467285,1.9513872861862183,0.8633544445037842,0.3870147466659546,1.6874123811721802,1.806374430656433,1.3066922426223755,2.052522659301758,0.9290130138397217,-1.2999485731124878,0.17261174321174622,0.42439234256744385,0.7602931261062622,-0.6579463481903076,1.108161449432373,-0.10625632852315903,-2.2837514877319336,-0.9729859828948975,-0.04317350313067436,0.4410702586174011,1.4795008897781372,-1.273394227027893,1.3970288038253784,-0.03960566595196724,-0.31206557154655457,-0.11967600136995316,1.2273224592208862,0.8439971208572388,-1.3889329433441162,0.005265276879072189,-0.11621494591236115,1.3635449409484863,0.05956600233912468,1.204398274421692,-1.2046711444854736,0.26776668429374695,-1.463710069656372,0.4116840064525604,0.9509539008140564,-1.1698297262191772,-0.877694845199585,1.7029297351837158,0.05609138309955597,0.41632595658302307,-0.41485825181007385,-0.17236752808094025,-0.8126874566078186,-1.1742292642593384,-0.22512289881706238,-0.4835955500602722,0.5080245733261108,-0.6449306607246399,0.6245540976524353,1.5846035480499268,0.4293898344039917,0.8961029648780823,-0.020299367606639862,-0.4076707363128662,-0.6950942873954773,0.8007360696792603,-0.6660522818565369,0.6954813599586487,-0.1957244724035263,-0.7270731925964355,1.0445963144302368,2.2743265628814697,-0.2467866986989975,-0.9927461743354797,1.6044827699661255,-0.19902102649211884,0.9560839533805847,-0.06820864975452423,-0.39064303040504456,-1.8902347087860107,-0.7445983290672302,-2.1150007247924805,0.14711013436317444,0.7261805534362793,0.04061174392700195,2.5945427417755127,0.43099725246429443,1.0811729431152344,1.02225923538208,-0.03123638965189457,0.22778084874153137,0.38346725702285767,0.6336159706115723,-1.0258090496063232,0.4680311381816864,0.15499335527420044,0.4850909411907196,1.2405301332473755,0.0444374717772007,0.09908983111381531,-0.7316924333572388,-0.575515627861023,0.0032997271046042442,2.059950351715088,-0.0871531292796135,0.04115106165409088,-0.13319091498851776,-0.4065052568912506,0.19742527604103088,1.068537950515747,1.2278132438659668,-1.2095476388931274,0.2588884234428406,0.16390284895896912,1.7082103490829468,0.4511335790157318,-1.2131311893463135,0.13856419920921326,-2.6510169506073,-1.0190298557281494,-0.5479287505149841,0.5812558531761169,0.05276177078485489,-1.2352023124694824,-0.6167201995849609,0.21754401922225952,1.9792975187301636,1.1424379348754883', NULL);

SET FOREIGN_KEY_CHECKS = 1;
